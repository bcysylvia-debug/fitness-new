<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«å†²åˆº (ç¬¬16-36èŠ‚)</title>
    <style>
        :root {
            --bg: #f4f7f6;
            --surface: #ffffff;
            --primary: #2196F3;    /* è®¡åˆ’è‰² */
            --success: #4CAF50;    /* å®Œæˆè‰² */
            --text-main: #333;
            --text-sub: #777;
            --today-border: #FF5722;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 800px; background: var(--surface); border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; padding: 20px; }
        
        /* é¡¶éƒ¨ä»ªè¡¨ç›˜ */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .card { background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #eee; }
        .card h3 { margin: 0; font-size: 2em; color: var(--text-main); }
        .card p { margin: 5px 0 0; color: var(--text-sub); font-size: 0.9em; }
        .progress-bar { grid-column: 1 / -1; background: #eee; height: 10px; border-radius: 5px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--success), var(--primary)); width: 0%; transition: width 0.5s ease; }

        /* æ—¥å†åŒºåŸŸ */
        .calendar-header { display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 10px; }
        .weekday { text-align: center; font-weight: bold; color: #999; font-size: 0.9em; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        
        .month-title { grid-column: 1 / -1; margin-top: 15px; margin-bottom: 5px; font-weight: bold; font-size: 1.1em; color: var(--text-main); padding-left: 5px; border-left: 4px solid var(--text-main); }

        .day {
            aspect-ratio: 1/1;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 5px;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.2s;
            background: #fff;
        }
        
        /* äº¤äº’çŠ¶æ€ */
        .day:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 2; }
        
        .day.is-today { border: 2px solid var(--today-border); }
        .day.is-today::after { content: "ä»Šå¤©"; position: absolute; top: -8px; right: -6px; background: var(--today-border); color: white; font-size: 0.6em; padding: 2px 5px; border-radius: 4px; }

        /* çŠ¶æ€æ ·å¼ */
        .day[data-status="planned"] { background-color: #E3F2FD; border-color: #BBDEFB; }
        .day[data-status="planned"] .tag { color: var(--primary); }
        
        .day[data-status="done"] { background-color: #E8F5E9; border-color: #C8E6C9; }
        .day[data-status="done"] .tag { color: var(--success); }

        .date-num { font-weight: bold; font-size: 1em; color: #444; }
        .tag { font-size: 0.75em; font-weight: 800; text-align: right; }
        .icon { position: absolute; top: 5px; right: 5px; font-size: 1em; opacity: 0.8; }

        /* åº•éƒ¨è¯´æ˜ */
        .legend { margin-top: 20px; display: flex; gap: 15px; justify-content: center; font-size: 0.85em; color: #666; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }

    </style>
</head>
<body>

<div class="app-container">
    <div style="text-align: center; margin-bottom: 20px;">
        <h2 style="margin: 0;">ğŸ’ª å¥èº«æ‰“å¡ (ç¬¬16~36è¯¾)</h2>
        <p style="margin: 5px 0 0; color: #888; font-size: 0.9em;">ç›®æ ‡æ—¥æœŸï¼š3æœˆ31æ—¥</p>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3 id="current-count">0</h3>
            <p>å·²å®Œæˆè¯¾æ—¶</p>
        </div>
        <div class="card">
            <h3 id="remaining-count">36</h3>
            <p>å‰©ä½™éœ€å®‰æ’</p>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div class="calendar-header">
        <div class="weekday">æ—¥</div><div class="weekday">ä¸€</div><div class="weekday">äºŒ</div>
        <div class="weekday">ä¸‰</div><div class="weekday">å››</div><div class="weekday">äº”</div>
        <div class="weekday">å…­</div>
    </div>

    <div id="calendar" class="calendar-grid"></div>

    <div class="legend">
        <span><i class="dot" style="background:var(--success)"></i>å·²å®Œæˆ</span>
        <span><i class="dot" style="background:var(--primary)"></i>è®¡åˆ’ä¸­</span>
        <span><i class="dot" style="background:var(--today-border)"></i>ä»Šå¤©</span>
    </div>
</div>

<script>
    // --- é…ç½®åŒºåŸŸ ---
    const CONFIG = {
        totalTarget: 36,     // æ€»ç›®æ ‡
        preCompleted: 15,    // ä¹‹å‰å·²ç»å®Œæˆçš„èŠ‚æ•° (1-15èŠ‚)
        startDate: new Date(2026, 0, 1), // æ˜¾ç¤ºèµ·å§‹æ—¥ (1æœˆ1æ—¥)
        endDate: new Date(2026, 2, 31)   // æ˜¾ç¤ºç»“æŸæ—¥ (3æœˆ31æ—¥)
    };

    // è·å–ä»Šå¤©æ—¥æœŸçš„å­—ç¬¦ä¸² (YYYY-MM-DD)
    const todayStr = new Date().toISOString().split('T')[0];

    // --- æ•°æ®åˆå§‹åŒ– ---
    // è¯»å–æœ¬åœ°å­˜å‚¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆå§‹åŒ–â€œä»Šå¤©â€ä¸ºå·²å®Œæˆ
    let schedule = JSON.parse(localStorage.getItem('fitnessSchedule_v3'));
    
    if (!schedule) {
        schedule = {};
        // é¦–æ¬¡æ‰“å¼€ï¼Œé»˜è®¤æŠŠä»Šå¤©(ç¬¬16èŠ‚)æ ‡è®°ä¸ºå·²å®Œæˆ
        schedule[todayStr] = 'done';
    }

    // --- æ ¸å¿ƒé€»è¾‘ ---

    function save() {
        localStorage.setItem('fitnessSchedule_v3', JSON.stringify(schedule));
        render();
    }

    function toggleDate(dateStr) {
        const currentStatus = schedule[dateStr];
        if (!currentStatus) {
            schedule[dateStr] = 'planned'; // ç©ºç™½ -> è®¡åˆ’
        } else if (currentStatus === 'planned') {
            schedule[dateStr] = 'done';    // è®¡åˆ’ -> å®Œæˆ
        } else {
            delete schedule[dateStr];      // å®Œæˆ -> ç©ºç™½
        }
        save();
    }

    function render() {
        const container = document.getElementById('calendar');
        container.innerHTML = '';

        // 1. è®¡ç®—è¯¾ç¨‹ç¼–å·
        // è·å–æ‰€æœ‰è¢«é€‰ä¸­çš„æ—¥æœŸå¹¶æ’åº
        const activeDates = Object.keys(schedule).sort();
        const dateToClassNum = {};
        
        activeDates.forEach((date, index) => {
            // æ ¸å¿ƒå…¬å¼ï¼šç¼–å· = ä¹‹å‰çš„15èŠ‚ + åˆ—è¡¨ä¸­çš„ä½ç½® + 1
            dateToClassNum[date] = CONFIG.preCompleted + index + 1;
        });

        // 2. æ¸²æŸ“æ—¥å†
        let current = new Date(CONFIG.startDate);
        let currentMonth = -1;

        while (current <= CONFIG.endDate) {
            const dateStr = current.toISOString().split('T')[0];
            const month = current.getMonth();
            const dayOfWeek = current.getDay();

            // ç»˜åˆ¶æœˆä»½åˆ†å‰²çº¿
            if (month !== currentMonth) {
                currentMonth = month;
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-title';
                monthDiv.innerText = `${current.getFullYear()}å¹´ ${month + 1}æœˆ`;
                container.appendChild(monthDiv);

                // è¡¥é½æœˆåˆçš„ç©ºç™½æ ¼å­
                for(let i=0; i<dayOfWeek; i++) {
                    container.appendChild(document.createElement('div'));
                }
            }

            // åˆ›å»ºæ—¥æœŸæ ¼å­
            const el = document.createElement('div');
            el.className = 'day';
            const status = schedule[dateStr];
            
            // æ ·å¼å¤„ç†
            if (dateStr === todayStr) el.classList.add('is-today');
            if (status) el.setAttribute('data-status', status);

            // å†…å®¹ç”Ÿæˆ
            let icon = '';
            if (status === 'done') icon = 'âœ…';
            if (status === 'planned') icon = 'ğŸ“…';

            let classNumDisplay = '';
            if (status) {
                classNumDisplay = `ç¬¬${dateToClassNum[dateStr]}èŠ‚`;
            }

            el.innerHTML = `
                <div class="date-num">${current.getDate()}</div>
                <div class="icon">${icon}</div>
                <div class="tag">${classNumDisplay}</div>
            `;

            el.onclick = () => toggleDate(dateStr);
            container.appendChild(el);

            current.setDate(current.getDate() + 1);
        }

        // 3. æ›´æ–°ç»Ÿè®¡é¢æ¿
        updateStats(activeDates.length);
    }

    function updateStats(visibleCount) {
        // æ€»å®Œæˆæ•° = ä¹‹å‰éšå½¢çš„15èŠ‚ + ç•Œé¢ä¸Šæ ‡è®°ä¸ºdoneçš„
        const doneOnCalendar = Object.values(schedule).filter(s => s === 'done').length;
        const totalDone = CONFIG.preCompleted + doneOnCalendar;
        
        // æ€»å®‰æ’æ•° = ä¹‹å‰éšå½¢çš„15èŠ‚ + ç•Œé¢ä¸Šæ‰€æœ‰çš„(done + planned)
        const totalPlanned = CONFIG.preCompleted + visibleCount;

        document.getElementById('current-count').innerText = totalDone;
        
        // å‰©ä½™éœ€è¦å®‰æ’çš„æ¬¡æ•° = æ€»ç›®æ ‡36 - å½“å‰å·²å®‰æ’çš„æ€»æ•°
        const remaining = Math.max(0, CONFIG.totalTarget - totalPlanned);
        document.getElementById('remaining-count').innerText = remaining;

        // è¿›åº¦æ¡ (åŸºäºå·²å®Œæˆ)
        const percent = Math.min(100, (totalDone / CONFIG.totalTarget) * 100);
        document.getElementById('progress-fill').style.width = `${percent}%`;
        
        // é¢œè‰²å˜åŒ–ï¼šå¦‚æœå·²å®‰æ’æ»¡36èŠ‚ï¼Œå‰©ä½™æ•°å­—å˜ç»¿
        if (remaining === 0) {
            document.getElementById('remaining-count').style.color = '#4CAF50';
        }
    }

    // å¯åŠ¨æ¸²æŸ“
    render();

</script>
</body>
</html>
