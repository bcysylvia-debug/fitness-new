<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«è§„åˆ’ (å®½æ•ç‰ˆ)</title>
    <style>
        :root {
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --primary: #2196F3;
            --success: #4CAF50;
            --text-main: #333;
            --border: #e0e0e0;
            --today-color: #ff5722;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg-color); padding: 20px; color: var(--text-main); }
        
        .container { max-width: 900px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }

        /* é¡¶éƒ¨åŒºåŸŸ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }
        .header h2 { margin: 0; font-size: 1.8em; color: #333; }
        .save-status { font-size: 0.9em; color: var(--success); font-weight: bold; opacity: 0; transition: opacity 0.5s; }
        .save-status.show { opacity: 1; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fafafa; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-num { display: block; font-size: 2em; font-weight: 800; margin-bottom: 5px; color: var(--success); }
        .stat-label { color: #666; font-size: 0.9em; }

        /* æ—¥å†ç½‘æ ¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        
        .weekday { text-align: center; font-weight: bold; color: #999; padding: 10px 0; border-bottom: 1px solid #eee; margin-bottom: 10px; }
        
        .month-label { grid-column: 1 / -1; margin-top: 20px; margin-bottom: 10px; font-size: 1.2em; font-weight: bold; color: #444; border-left: 5px solid var(--primary); padding-left: 10px; }

        /* å•ä¸ªæ—¥æœŸæ ¼å­ - å®½æ•ç‰ˆ */
        .day {
            aspect-ratio: 1/1; /* ä¿æŒæ­£æ–¹å½¢ */
            min-height: 80px;  /* æœ€å°é«˜åº¦ */
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .day:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--primary); z-index: 2; }
        
        /* ä»Šå¤©çš„é«˜äº® */
        .day.today { border: 2px solid var(--today-color); }
        .day.today::after { content: "ä»Šæ—¥"; position: absolute; top: -10px; right: -5px; background: var(--today-color); color: white; padding: 2px 8px; font-size: 0.8em; border-radius: 10px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* çŠ¶æ€æ ·å¼ */
        .day[data-status="planned"] { background-color: #e3f2fd; border-color: var(--primary); }
        .day[data-status="done"] { background-color: #e8f5e9; border-color: var(--success); }

        .date-num { font-size: 1.1em; font-weight: 600; color: #555; }
        .class-tag { font-size: 0.9em; font-weight: bold; text-align: right; margin-top: auto; padding: 4px 0; }
        
        [data-status="planned"] .class-tag { color: var(--primary); }
        [data-status="done"] .class-tag { color: var(--success); }

        /* åº•éƒ¨è¯´æ˜ */
        .legend { margin-top: 30px; display: flex; gap: 20px; justify-content: center; color: #666; }
        .dot { width: 12px; height: 12px; border-radius: 4px; display: inline-block; margin-right: 6px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ‹ï¸ å¥èº«è®¡åˆ’ (ç¬¬21-36èŠ‚)</h2>
        <div id="save-msg" class="save-status">âœ… è‡ªåŠ¨ä¿å­˜æˆåŠŸ</div>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <span class="stat-num" id="done-count">0/36</span>
            <span class="stat-label">æ€»è¿›åº¦ (å·²å®Œæˆ)</span>
        </div>
        <div class="stat-card">
            <span class="stat-num" id="left-count" style="color:#ff9800">0</span>
            <span class="stat-label">å‰©ä½™éœ€å®‰æ’</span>
        </div>
    </div>

    <div class="calendar-grid" id="calendar">
        <div class="weekday">å‘¨æ—¥</div><div class="weekday">å‘¨ä¸€</div><div class="weekday">å‘¨äºŒ</div>
        <div class="weekday">å‘¨ä¸‰</div><div class="weekday">å‘¨å››</div><div class="weekday">å‘¨äº”</div>
        <div class="weekday">å‘¨å…­</div>
    </div>

    <div class="legend">
        <span><i class="dot" style="background:var(--success)"></i>å·²å®Œæˆ</span>
        <span><i class="dot" style="background:var(--primary)"></i>è®¡åˆ’ä¸­</span>
        <span><i class="dot" style="background:var(--today-color)"></i>ä»Šå¤©</span>
    </div>
</div>

<script>
    // --- é€»è¾‘é…ç½® (ä¿æŒä¸å˜) ---
    const CONFIG = {
        totalGoal: 36,
        baseCount: 20, // 1æœˆ15æ—¥å‰é»˜è®¤å·²å®Œæˆ20èŠ‚
        startDate: new Date(2026, 0, 1), // 1æœˆ1æ—¥
        endDate: new Date(2026, 2, 31)   // 3æœˆ31æ—¥
    };

    // æœ¬åœ°å­˜å‚¨Key (ä¿æŒä¸€è‡´ï¼Œä»¥å…ä¸¢å¤±æ•°æ®)
    const STORAGE_KEY = 'gym_calendar_final_fixed';

    // å·¥å…·å‡½æ•°ï¼šè·å– YYYY-MM-DD
    function getIsoDate(date) {
        const offset = date.getTimezoneOffset() * 60000;
        const localDate = new Date(date.getTime() - offset);
        return localDate.toISOString().split('T')[0];
    }
    const todayStr = getIsoDate(new Date());

    // åˆå§‹åŒ–æ•°æ®
    let schedule = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    
    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé»˜è®¤æ ‡è®°ä»Šå¤©ä¸ºå®Œæˆ
    if (Object.keys(schedule).length === 0) {
        schedule[todayStr] = 'done';
        localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
    }

    // æ¸²æŸ“å‡½æ•°
    function render() {
        const container = document.getElementById('calendar');
        // ä¿å­˜è¡¨å¤´
        const headers = Array.from(container.querySelectorAll('.weekday'));
        container.innerHTML = '';
        headers.forEach(h => container.appendChild(h));

        // 1. æ’åºè®¡ç®—
        const sortedDates = Object.keys(schedule).sort();
        const dateToNum = {};
        sortedDates.forEach((d, i) => {
            dateToNum[d] = CONFIG.baseCount + i + 1;
        });

        // 2. å¾ªç¯ç”Ÿæˆæ—¥å†
        let current = new Date(CONFIG.startDate);
        let currentMonth = -1;

        while (current <= CONFIG.endDate) {
            const dateStr = getIsoDate(current);
            const month = current.getMonth();
            const dayOfWeek = current.getDay();

            // æœˆä»½åˆ†éš”
            if (month !== currentMonth) {
                currentMonth = month;
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-label';
                monthDiv.innerText = `${current.getFullYear()}å¹´ ${month + 1}æœˆ`;
                container.appendChild(monthDiv);
                
                // è¡¥é½å½“æœˆç¬¬ä¸€å¤©å‰é¢çš„ç©ºæ ¼
                for(let i=0; i<dayOfWeek; i++) {
                    container.appendChild(document.createElement('div'));
                }
            }

            // åˆ›å»ºæ ¼å­
            const el = document.createElement('div');
            el.className = 'day';
            
            if (dateStr === todayStr) el.classList.add('today');
            
            const status = schedule[dateStr];
            if (status) el.setAttribute('data-status', status);

            const numText = status ? `ç¬¬${dateToNum[dateStr]}èŠ‚` : '';
            
            el.innerHTML = `
                <div class="date-num">${current.getDate()}</div>
                <div class="class-tag">${numText}</div>
            `;

            // ç‚¹å‡»äº‹ä»¶
            el.onclick = () => {
                if (!status) schedule[dateStr] = 'planned';
                else if (status === 'planned') schedule[dateStr] = 'done';
                else delete schedule[dateStr];

                // ä¿å­˜å¹¶åé¦ˆ
                localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
                showSaveTip();
                render();
            };

            container.appendChild(el);
            current.setDate(current.getDate() + 1);
        }

        updateStats(sortedDates.length);
    }

    function updateStats(scheduledCount) {
        const doneCount = Object.values(schedule).filter(s => s === 'done').length;
        const totalDone = CONFIG.baseCount + doneCount;
        const totalScheduled = CONFIG.baseCount + scheduledCount;

        document.getElementById('done-count').innerText = `${totalDone}/${CONFIG.totalGoal}`;
        document.getElementById('left-count').innerText = Math.max(0, CONFIG.totalGoal - totalScheduled);
    }

    function showSaveTip() {
        const tip = document.getElementById('save-msg');
        tip.classList.add('show');
        setTimeout(() => tip.classList.remove('show'), 1000);
    }

    render();
</script>
</body>
</html>
