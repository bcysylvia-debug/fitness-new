<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¥èº«è¯¾ç¨‹å…¨å‘¨æœŸç®¡ç† (è‡³3æœˆåº•)</title>
    <style>
        :root {
            --bg: #f0f2f5;
            --card-bg: #fff;
            --planned-bg: #e3f2fd;
            --planned-text: #1976d2;
            --done-bg: #e8f5e9;
            --done-text: #2e7d32;
            --today-border: #ff5722;
            --border-color: #eee;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: var(--card-bg); padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        
        .header { text-align: center; margin-bottom: 25px; }
        .header h2 { margin: 0 0 10px 0; color: #333; }
        .header p { color: #666; font-size: 0.95em; }

        /* çŠ¶æ€ç»Ÿè®¡æ  */
        .stats { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .stat-box { flex: 1; background: #fafafa; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--border-color); min-width: 100px; }
        .stat-num { font-size: 1.5em; font-weight: bold; display: block; margin-bottom: 5px; }
        .stat-label { font-size: 0.85em; color: #777; }
        .c-blue { color: var(--planned-text); }
        .c-green { color: var(--done-text); }

        /* æ—¥å†ç½‘æ ¼ */
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .weekday-head { text-align: center; font-weight: bold; color: #888; padding: 10px 0; font-size: 0.9em; }
        
        .month-label { grid-column: 1 / -1; margin-top: 15px; margin-bottom: 5px; font-weight: bold; font-size: 1.1em; color: #444; padding-left: 5px; border-left: 4px solid #333; line-height: 1.2; }

        .day { 
            background: #fff; border: 1px solid var(--border-color); border-radius: 8px; 
            min-height: 70px; padding: 6px; cursor: pointer; position: relative;
            display: flex; flex-direction: column; justify-content: space-between;
            transition: all 0.2s; select-user: none;
        }
        .day:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.08); z-index: 2; border-color: #ddd; }
        
        /* çŠ¶æ€æ ·å¼ */
        .day[data-status="planned"] { background: var(--planned-bg); border-color: var(--planned-text); }
        .day[data-status="done"] { background: var(--done-bg); border-color: var(--done-text); }
        .day.is-today { border: 2px solid var(--today-border) !important; position: relative; }
        .day.is-today::after { content: "ä»Šæ—¥"; position: absolute; top: -8px; right: -5px; background: var(--today-border); color: white; font-size: 0.7em; padding: 2px 6px; border-radius: 4px; }

        .date-num { font-weight: 600; font-size: 1em; }
        .class-info { font-size: 0.75em; font-weight: bold; text-align: right; margin-top: auto; }
        .status-icon { position: absolute; top: 6px; right: 6px; font-size: 1.1em; }

        .legend { margin-top: 20px; display: flex; gap: 20px; justify-content: center; font-size: 0.9em; color: #666; }
        .legend span { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ‹ï¸ å¥èº«è¯¾å†²åˆºæ’æœŸ (Jan - Mar)</h2>
        <p>ç‚¹å‡»æ—¥æœŸåˆ‡æ¢çŠ¶æ€ï¼šç©ºç™½ â†’ ğŸ“… è®¡åˆ’ â†’ âœ… å·²å®Œæˆ</p>
    </div>

    <div class="stats">
        <div class="stat-box">
            <span class="stat-num" id="total-progress">0/36</span>
            <span class="stat-label">æ€»è¿›åº¦ (å·²å®Œ+è®¡åˆ’)</span>
        </div>
        <div class="stat-box">
            <span class="stat-num c-green" id="done-count">0</span>
            <span class="stat-label">å·²å®Œæˆè¯¾æ—¶</span>
        </div>
        <div class="stat-box">
            <span class="stat-num c-blue" id="planned-count">0</span>
            <span class="stat-label">å¾…æ‰§è¡Œè®¡åˆ’</span>
        </div>
        <div class="stat-box">
            <span class="stat-num" id="days-left">0</span>
            <span class="stat-label">è·ç¦»3æœˆ31æ—¥å¤©æ•°</span>
        </div>
    </div>

    <div id="calendar" class="calendar">
        </div>

    <div class="legend">
        <span><div class="dot" style="background:var(--done-text)"></div> å·²å®Œæˆ</span>
        <span><div class="dot" style="background:var(--planned-text)"></div> è®¡åˆ’ä¸­</span>
        <span><div class="dot" style="border:1px solid #ccc"></div> ä¼‘æ¯æ—¥</span>
    </div>
</div>

<script>
    // é…ç½®å‚æ•°
    const config = {
        startDate: new Date(2026, 0, 1), // ä»1æœˆ1æ—¥å¼€å§‹æ˜¾ç¤ºï¼Œæ–¹ä¾¿æ‚¨è¡¥å½•ä¹‹å‰çš„è®°å½•
        endDate: new Date(2026, 2, 31),  // åˆ°3æœˆ31æ—¥
        totalClasses: 36
    };

    // çŠ¶æ€æ•°æ®ï¼škeyä¸ºæ—¥æœŸå­—ç¬¦ä¸²(YYYY-MM-DD), valueä¸ºçŠ¶æ€('planned' | 'done')
    let classData = JSON.parse(localStorage.getItem('gymClassData_v2')) || {};
    
    // åˆå§‹åŒ–ï¼šå¦‚æœæ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œå°è¯•æ ¹æ®ç”¨æˆ·æè¿°é¢„è®¾ä»Šå¤©
    const todayStr = new Date().toISOString().split('T')[0];
    if (Object.keys(classData).length === 0) {
        // è¿™æ˜¯ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œé»˜è®¤æ ‡è®°ä»Šå¤©ä¸º"å·²å®Œæˆ"
        // æ‚¨å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»è¿‡å»çš„æ—¥æœŸæ¥è¡¥å…¨å‰15èŠ‚è¯¾
        classData[todayStr] = 'done';
    }

    const calendarEl = document.getElementById('calendar');

    function getStatusIcon(status) {
        if (status === 'done') return 'âœ…';
        if (status === 'planned') return 'ğŸ“…';
        return '';
    }

    function toggleDate(dateStr) {
        const current = classData[dateStr];
        if (!current) {
            classData[dateStr] = 'planned';
        } else if (current === 'planned') {
            classData[dateStr] = 'done';
        } else {
            delete classData[dateStr];
        }
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('gymClassData_v2', JSON.stringify(classData));
        render();
    }

    function render() {
        calendarEl.innerHTML = '';
        
        // ç”Ÿæˆè¡¨å¤´
        const weeks = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        weeks.forEach(w => {
            const el = document.createElement('div');
            el.className = 'weekday-head';
            el.innerText = w;
            calendarEl.appendChild(el);
        });

        // æ•´ç†æ‰€æœ‰è¢«é€‰ä¸­çš„æ—¥æœŸï¼Œç”¨äºæ’åºè®¡ç®—â€œç¬¬å‡ èŠ‚â€
        const sortedDates = Object.keys(classData).sort();
        const dateIndexMap = {}; // å­˜å‚¨æ¯ä¸ªæ—¥æœŸå¯¹åº”æ˜¯ç¬¬å‡ èŠ‚è¯¾
        sortedDates.forEach((date, index) => {
            dateIndexMap[date] = index + 1;
        });

        // æ¸²æŸ“æ—¥å†ä¸»ä½“
        let current = new Date(config.startDate);
        let currentMonth = -1;

        while (current <= config.endDate) {
            const year = current.getFullYear();
            const month = current.getMonth();
            const dateStr = current.toISOString().split('T')[0];
            const dayNum = current.getDate();
            const dayOfWeek = current.getDay();

            // å¦‚æœæ¢æœˆäº†ï¼Œæ’å…¥æœˆä»½æ ‡é¢˜
            if (month !== currentMonth) {
                currentMonth = month;
                
                // æ’å…¥æœˆä»½è¡Œ
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-label';
                monthDiv.innerText = `${year}å¹´ ${month + 1}æœˆ`;
                
                // å¦‚æœä¸æ˜¯ç¬¬ä¸€è¡Œï¼Œéœ€è¦è®©æœˆä»½ç‹¬å ä¸€è¡Œï¼Œä½†Gridå¸ƒå±€é‡Œç›´æ¥æ’ä¸­é—´æœ‰ç‚¹éº»çƒ¦
                // è¿™é‡Œé‡‡ç”¨ç®€å•çš„æµå¼å¤„ç†ï¼šå…ˆå¼ºåˆ¶æ¢è¡Œï¼Œä½†gridä¸éœ€è¦. 
                // ä¸ºäº†ç¾è§‚ï¼Œæˆ‘ä»¬æŠŠæœˆä»½æ ‡ç­¾æ”¾åœ¨gridé‡Œå¹¶å æ»¡ä¸€è¡Œ
                // å¦‚æœå½“å‰è¡Œä¸æ˜¯å‘¨æ—¥å¼€å¤´ï¼Œéœ€è¦å¡«è¡¥ç©ºç™½æ ¼å­ç›´åˆ°æœ¬è¡Œç»“æŸï¼Œå†æ”¾æœˆä»½ï¼Ÿ
                // ç®€åŒ–æ–¹æ¡ˆï¼šç›´æ¥æ’å…¥æœˆä»½Labelå æ»¡7æ ¼
                // æ¢æœˆæ—¶ï¼Œå¦‚æœæ˜¯æ–°çš„ä¸€è¡Œå¼€å¤´æœ€å¥½ï¼Œå¦‚æœä¸æ˜¯ï¼Œå…ˆè¡¥é½ä¸Šä¸€è¡Œçš„ç©ºç™½
                
                // ä¸ºäº†å¸ƒå±€ç®€å•ï¼Œæˆ‘ä»¬å…è®¸æœˆä»½æ ‡ç­¾æ’åœ¨ä¸­é—´ï¼Œ
                // ä½†éœ€è¦å…ˆè¡¥é½ä¸Šä¸€æœˆå‰©ä½™çš„ç©ºç™½æ ¼å­
                const lastDayOfPrevMonth = new Date(current);
                lastDayOfPrevMonth.setDate(0); // ä¸Šæœˆæœ€åä¸€å¤©
                const prevMonthEndDay = lastDayOfPrevMonth.getDay();
                
                // è¿™é‡Œçš„é€»è¾‘ç¨å¾®å¤æ‚ï¼Œä¸ºäº†ä»£ç ç®€æ´ï¼Œæˆ‘ä»¬åªåœ¨æ¯æœˆ1å·å‰æ’å…¥æœˆä»½å¤´
                // å¹¶åœ¨æ¯æœˆ1å·å‰è¡¥é½è¯¥å‘¨çš„ç©ºç™½
                
                calendarEl.appendChild(monthDiv);
                
                // è¡¥é½å½“æœˆ1å·ä¹‹å‰çš„ç©ºç™½
                for(let i=0; i<dayOfWeek; i++) {
                    calendarEl.appendChild(document.createElement('div'));
                }
            }

            const el = document.createElement('div');
            el.className = 'day';
            const status = classData[dateStr];
            if (status) el.setAttribute('data-status', status);
            
            // åˆ¤æ–­æ˜¯å¦ä»Šå¤©
            if (dateStr === todayStr) el.classList.add('is-today');

            // è¯¾ç¨‹ç¼–å·
            let classNumText = '';
            if (status) {
                classNumText = `ç¬¬${dateIndexMap[dateStr]}èŠ‚`;
            }

            el.innerHTML = `
                <div class="date-num">${dayNum}</div>
                ${status ? `<div class="status-icon">${getStatusIcon(status)}</div>` : ''}
                <div class="class-info" style="color:${status==='planned'?'var(--planned-text)':'var(--done-text)'}">${classNumText}</div>
            `;

            el.onclick = () => toggleDate(dateStr);
            calendarEl.appendChild(el);

            current.setDate(current.getDate() + 1);
        }

        updateStats(sortedDates.length);
    }

    function updateStats(totalPlannedAndDone) {
        const doneCount = Object.values(classData).filter(s => s === 'done').length;
        const plannedCount = Object.values(classData).filter(s => s === 'planned').length;
        
        document.getElementById('total-progress').innerText = `${totalPlannedAndDone}/${config.totalClasses}`;
        document.getElementById('done-count').innerText = doneCount;
        document.getElementById('planned-count').innerText = plannedCount;
        
        const now = new Date();
        const end = config.endDate;
        const diff = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
        document.getElementById('days-left').innerText = diff > 0 ? diff : 0;
    }

    render();
</script>
</body>
</html>
